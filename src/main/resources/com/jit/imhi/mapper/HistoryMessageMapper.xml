<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jit.imhi.mapper.HistoryMessageMapper">
    <resultMap id="BaseResultMap" type="com.jit.imhi.model.HistoryMessage">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jan 17 11:08:47 CST 2018.
        -->
        <id column="message_id" property="messageId" jdbcType="INTEGER"/>
        <result column="user_from_id" property="userFromId" jdbcType="INTEGER"/>
        <result column="to_id" property="toId" jdbcType="INTEGER"/>
        <result column="text_type" property="textType" jdbcType="INTEGER"/>
        <result column="text_content" property="textContent" jdbcType="CHAR"/>
        <result column="message_type" property="messageType" jdbcType="INTEGER"/>
        <result column="date" property="date" jdbcType="TIMESTAMP"/>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jan 17 11:08:47 CST 2018.
        -->
        delete from history_message
        where message_id = #{messageId,jdbcType=INTEGER}
    </delete>

    <delete id="deleteFriend" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jan 17 11:08:47 CST 2018.
        -->
        delete from history_message
        where user_from_id = #{userId,jdbcType=INTEGER} AND
        to_id = #{friendId,jdbcType=INTEGER} AND
        message_type = #{messageType,jdbcType=INTEGER}
    </delete>

    <update id="updateByPrimaryKey" parameterType="com.jit.imhi.model.HistoryMessage">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jan 17 11:08:47 CST 2018.
        -->
        update history_message
        set user_from_id = #{userFromId,jdbcType=INTEGER},
        to_id = #{toId,jdbcType=INTEGER},
        text_type = #{textType,jdbcType=INTEGER},
        text_content = #{textContent,jdbcType=CHAR},
        message_type = #{messageType,jdbcType=INTEGER},
        date = #{date,jdbcType=TIMESTAMP}
        where message_id = #{messageId,jdbcType=INTEGER}
    </update>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jan 17 11:08:47 CST 2018.
        -->
        select message_id, user_from_id, to_id, text_type, text_content, message_type, date
        from history_message
        where message_id = #{messageId,jdbcType=INTEGER}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Jan 17 11:08:47 CST 2018.
        -->
        select message_id, user_from_id, to_id, text_type, text_content, message_type, date
        from history_message
    </select>
    <!--yuyisummer 修改过后的Insert-->
    <!--
    <insert id="insert" parameterType="com.jit.imhi.model.HistoryMessage" >
      <selectKey keyProperty="messageId" order="AFTER" resultType="java.lang.Integer">
        SELECT LAST_INSERT_ID()
      </selectKey>
      insert into history_message (message_id, user_from_id, to_id,
      text_type, text_content, message_type,
      date)
      values (#{messageId,jdbcType=INTEGER}, #{userFromId,jdbcType=INTEGER}, #{toId,jdbcType=INTEGER},
      #{textType,jdbcType=INTEGER}, #{textContent,jdbcType=CHAR}, #{messageType,jdbcType=INTEGER},
      #{date,jdbcType=TIMESTAMP})
    </insert>-->
    <insert id="insert" parameterType="com.jit.imhi.model.HistoryMessage">
        <selectKey keyProperty="messageId" order="AFTER" resultType="int">
            SELECT LAST_INSERT_ID() AS messageId
        </selectKey>
        insert into history_message (message_id, user_from_id, to_id,
        text_type, text_content, message_type,
        date)
        values (#{messageId,jdbcType=INTEGER}, #{userFromId,jdbcType=INTEGER}, #{toId,jdbcType=INTEGER},
        #{textType,jdbcType=INTEGER}, #{textContent,jdbcType=CHAR}, #{messageType,jdbcType=INTEGER},
        #{date,jdbcType=TIMESTAMP})
    </insert>
    <!--    int updateAddSuccess(@Param("userFromId") Integer userFromId,
                           @Param("toId") Integer toId, @Param("messageType")
                                   Integer messageType);-->
    <update id="updateType" parameterType="com.jit.imhi.model.HistoryMessage">
    update history_message
    set
    message_type = #{messageType,jdbcType=INTEGER}

    where message_type = 8
    and user_from_id = #{userFromId,jdbcType=INTEGER}
    and to_id = #{toId,jdbcType=INTEGER}
  </update>

    <update id="updateGroupType" parameterType="com.jit.imhi.model.HistoryMessage">
        update history_message
        set
        message_type = #{messageType,jdbcType=INTEGER}

        where message_type = 11
        and user_from_id = #{userFromId,jdbcType=INTEGER}
        and to_id = #{toId,jdbcType=INTEGER}
    </update>


    <!--yuyisummer 1.20 23.55  -->
    <select id="selectTheNum" resultType="java.lang.Integer"  parameterType="com.jit.imhi.model.Numinfo" >
    select COUNT(message_id)
    from history_message
    where message_type = #{friendType,jdbcType=INTEGER}
    and user_from_id = #{userId,jdbcType=INTEGER}
    and to_id = #{friendId,jdbcType=INTEGER}
    and  message_id <![CDATA[ >= ]]>  #{oldId,jdbcType=INTEGER}
    and  message_id <![CDATA[ <= ]]>  #{newId,jdbcType=INTEGER}
  </select>

    <!--yuyisummer 1.21 0.24-->
    <select id="selectNoticNum" resultType="java.lang.Integer"  parameterType="com.jit.imhi.model.Numinfo" >
        select count(message_id)
        from history_message
        where message_type = #{friendType,jdbcType=VARCHAR}
        and to_id = #{userId,jdbcType=INTEGER}
        and  message_id <![CDATA[ >= ]]>  #{oldId,jdbcType=INTEGER}
        and  message_id <![CDATA[ <= ]]>  #{newId,jdbcType=INTEGER}
    </select>
    <!--yuyisummer  1.22-->
    <select id="selectNotic" resultType="com.jit.imhi.model.HistoryMessage" parameterType="com.jit.imhi.model.Numinfo">
        select *
        from history_message
        where message_type = #{friendType,jdbcType=VARCHAR}
        and to_id = #{userId,jdbcType=INTEGER}
        and  message_id <![CDATA[ >= ]]>  #{oldId,jdbcType=INTEGER}
        and  message_id <![CDATA[ <= ]]>  #{newId,jdbcType=INTEGER}
        order by  message_id DESC
        limit 10
    </select>
</mapper>